#!/usr/bin/env bash
set -euo pipefail

# Wrapper to run the generator from anywhere, against the current directory.
# Usage: flutter-clean [--state bloc|riverpod|provider|getx] [--name "App Name"]

resolve_link() {
  local target="$1"
  while [ -L "$target" ]; do
    local dir
    dir="$(cd -P "$(dirname "$target")" >/dev/null 2>&1 && pwd)"
    target="$(readlink "$target")"
    case "$target" in
      /*) ;;
      *) target="$dir/$target" ;;
    esac
  done
  printf '%s' "$target"
}

script_path="$(resolve_link "${BASH_SOURCE[0]}")"
script_dir="$(cd -P "$(dirname "$script_path")" >/dev/null 2>&1 && pwd)"
repo_root="$(cd -P "${script_dir}/.." && pwd)"

if [[ "${OS:-}" == "Windows_NT" ]]; then
  echo "Detected Windows. Please run 'powershell -ExecutionPolicy Bypass -File ${repo_root//\//\\}\\scripts\\setup-windows.ps1' or use bin\\flutter-clean.ps1" 1>&2
  exit 1
fi

if [[ $# -eq 0 ]]; then
  set -- --auto --profile minimal
fi

exec "${repo_root}/scripts/setup-unix.sh" "$@"
